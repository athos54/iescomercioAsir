# isc-dhcp-server

## Índice
* Configuración básica.
* Desactivar cache bind
* Forwarders
* Permitir consultas dns sólo desde determinadas redes
* Comandos de detección de errores:

## Ficheros principales:

* `/etc/bind/named.conf`
* `/etc/bind/named.conf.default-zones`
* `/etc/bind/named.conf.local`
* `/etc/bind/named.conf.options`

## Configuración básica.

Para realizar una configuración básica lo primero que tendremos que hacer es modificar el fichero `named.conf.local` y añadir la zona y su correspondiente fichero.

```
zone "athos.com" {
	type master;
	file "/etc/bind/athos.com.zone";
};
```

Lo siguiente que tenemos que hacer es crear el fichero que definimos en la zona `athos.com.zone`

Para crear la estructura, podemos utilizar uno de los ficheros que hay en el directorio:

`cp db.empty athos.com.zone`

Despues nos pondremos a configurar el archivo.

```
; BIND reverse data file for empty rfc1918 zone
;
; DO NOT EDIT THIS FILE - it is used for multiple zones.
; Instead, copy it, edit named.conf, and use that copy.
;
$ORIGIN athos.com.
$TTL	86400
@	IN	SOA	athos.com. root.localhost. (
			      1		; Serial
			 604800		; Refresh
			  86400		; Retry
			2419200		; Expire
			  86400 )	; Negative Cache TTL
;
@	IN	NS	localhost.
page1	IN	A	192.168.1.100
page2	IN	A	192.168.2.100

```
Añadimos `$ORIGIN` para evitarnos tener que poner en los registros que añadimos el dominio completo.

El ejemplo de arriba podríamos haberlo puesto tambien de la siguietne manera:

```
; BIND reverse data file for empty rfc1918 zone
;
; DO NOT EDIT THIS FILE - it is used for multiple zones.
; Instead, copy it, edit named.conf, and use that copy.
;
$TTL	86400
@	IN	SOA	athos.com. root.localhost. (
			      1		; Serial
			 604800		; Refresh
			  86400		; Retry
			2419200		; Expire
			  86400 )	; Negative Cache TTL
;
@	IN	NS	localhost.
page1.athos.com.	IN	A	192.168.1.100
page2.athos.com.	IN	A	192.168.2.100

```

Hay que prestar especial atencion al "." final de $ORIGIN, al del registro SOA y al del registro NS

Con esto ya tendremos el servidor configurado de una forma básica.

## Desactivar cache bind

Para desactivar la cache de bind, solo tendremos que borrar/comentar el siguiente codigo del archivo `/etc/bind/named.conf.default-zones`

```
zone "." {
	type hint;
	file "/etc/bind/db.root";
};
```

## Forwarders

En la directiva forwarders del archivo `named.conf.options` podremos configurar los servidores dns a los que nuestro servidor preguntará en caso de que no sepa la direccion ip del dominio por el que se le pregunta.

El archivo `named.conf.options` por defecto es el siguiente

```
options {
	directory "/var/cache/bind";

	// If there is a firewall between you and nameservers you want
	// to talk to, you may need to fix the firewall to allow multiple
	// ports to talk.  See http://www.kb.cert.org/vuls/id/800113

	// If your ISP provided one or more IP addresses for stable
	// nameservers, you probably want to use them as forwarders.  
	// Uncomment the following block, and insert the addresses replacing
	// the all-0's placeholder.

	// forwarders {
	// 	0.0.0.0;
	// };

	//========================================================================
	// If BIND logs error messages about the root key being expired,
	// you will need to update your keys.  See https://www.isc.org/bind-keys
	//========================================================================
	dnssec-validation auto;

	auth-nxdomain no;    # conform to RFC1035
	listen-on-v6 { any; };
};

```

Para habilitar los forwarders tendremos que descomentar dichas lineas y poner la dirección de los servidores que permitimos.

```
forwarders {
 	8.8.8.8;
};

```

Si queremos que nuestro servidor **sólo** use los forwarders y no use los servidores raid tenemos dos opciones

* la primera es eliminar los servidores raid bien borrandolos en el archivo `named.conf.default-zones` o comentando la siguiente linea en el archivo `named.conf` -> `include "/etc/bind/named.conf.default-zones";`

* la segunda es añadiendo en el archivo `named.conf.options` la directiva `forward only;`

## Permitir consultas dns sólo desde determinadas redes

Podemos configurar desde que clientes o redes queremos permitir que se hagan las consultas dns. Esto lo hacemos mediante la directiva `allow-query` en el archivo `named.conf.options` como se ve en el siguiente ejemplo.

```
allow-query {
	192.168.1.0/24;
	192.168.2.0/24;
};
```

En el ejemplo anterior sólo permitiremos las consultas dns desde las redes 192.168.2.0/24 y 192.168.1.0/24

Si no lo especificamos por defecto **creo** que permite desde todas las direcciones.

Si queremos permitir expresamente consultas de todas las direcciones podemos poner lo siguiente:

```
allow-query {
  any;
};
```

## Comandos de detección de errores:
`named-checkconf`: analiza la sintaxis de los ficheros de configuración del bind y nos 	indica si se detectan errores. No analiza ficheros de zona.

`named-checkzone`: analiza una determinada zona para ver si su sintaxis es correcta.
	-Ejemplo: named-checkzone asir.comercio /etc/bind/asir.comercio
-Fichero de zona
